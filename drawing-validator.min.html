<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPA PDF Viewer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
    <style>
        body {
            font-family: 'Barlow Condensed', sans-serif;
            background-color: #121212;
            color: #FFC425;
        }
        #pdf-preview {
            width: 33%; /* 1/3 of viewport width */
            height: auto;
            border: 1px solid #ddd;
            overflow: hidden;
            position: relative;
            margin-bottom: 1em;
        }
        #pdf-preview canvas {
            width: 100%;
            height: auto;
        }
        #summary-table, #metadata {
            margin-top: 1em;
        }
        h1, button {
            color: #FFC425;
        }
        button {
            border: none;
            padding: 0.5em 1em;
        }
        button.button-primary {
            background-color: #00502F;
            color: #FFFFFF;
        }
        input[type="range"] {
            width: 100%;
        }
        .pagination {
            display: flex;
            list-style: none;
            padding: 0;
            gap: 0.5em;
        }
        .pagination li {
            display: inline;
        }
        .pagination button {
            background-color: #00502F;
            color: #FFFFFF;
            border: none;
            padding: 0.5em 1em;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="background-color: #121212;">Drawing Analysis Validation</h1>
        Given a PDF of a drawing, this tooling analyzes the for typical issues of that can prevent downstream processing and integration into digital systems. 
        
        To begin, upload a PDF. Then, review the Analysis table to confirm that the drawing is in good shape.
        <br>
        <br>
        <button id="loadPdfBtn" class="button-primary">Load a Drawing PDF</button>
        <input type="file" id="pdfInput" accept="application/pdf" style="display:none;">
        <br>
        <br>
        <div id="pdf-preview">
            <canvas id="pdf-canvas"></canvas>
        </div>
        <div>
            <label for="zoomSlider">Zoom: </label>
            <input type="range" id="zoomSlider" min="0.1" max="4" step="0.1" value="1">
        </div>
        <div>
            <ul class="pagination" id="paginationControls"></ul>
        </div>
        <div id="summary-table">
            <h4>PDF Analysis</h4>
            <table>
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Count</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>PDF Text Elements</td>
                        <td id="textBoxCount">0</td>
                        <td>A typical drawing has hundreds of text elements. If this is much fewer, it typically indicates a bitmap conversion error upstream.</td>
                    </tr>
                    <tr>
                        <td>Comments</td>
                        <td id="commentsCount">0</td>
                        <td>Should match the expected number of comments (typically zero or a handful).</td>
                    </tr>
                    <tr>
                        <td>SHX Comments</td>
                        <td id="shxCommentsCount">0</td>
                        <td>Should be zero, or close to it. If not, generate in AutoCAD with TrueType font substitution enabled.</td>
                    </tr>
                    <tr>
                        <td>Layers</td>
                        <td id="layerCount">1</td>
                        <td></td>
                    </tr>

                </tbody>
            </table>
        </div>
        <div id="metadata">
            <h4>Document Metadata</h4>
            <ul>
                <li>Filename: <span id="filename"></span></li>
                <li>Creation Date: <span id="creationDate"></span></li>
                <li>Modification Date: <span id="modificationDate"></span></li>
                <li>Created By: <span id="createdBy"></span></li>
                <li>Modified By: <span id="modifiedBy"></span></li>
            </ul>
        </div>
        <div id="contact">
            For questions contact bmgue@pcl.com. Version: 1.2.4.  Released 2-Nov-2024. 
        </div>
    </div>
    <script>
const t=document.getElementById("pdfInput"),e=document.getElementById("loadPdfBtn"),n=document.getElementById("pdf-canvas"),o=document.getElementById("zoomSlider"),d=document.getElementById("paginationControls"),a=document.getElementById("pdf-preview");let c=null,i=1,m=1;function l(){c.getPage(i).then((t=>{const e=t.getViewport({scale:m});n.width=e.width,n.height=e.height,a.style.width=25*m+"%";const o={canvasContext:n.getContext("2d"),viewport:e};t.render(o)}))}function s(t){d.innerHTML="";for(let e=1;e<=t;e++){const t=document.createElement("li"),n=document.createElement("button");n.textContent=e,n.addEventListener("click",(()=>{i=e,l()})),t.appendChild(n),d.appendChild(t)}}function r(t){t.getMetadata().then((t=>{const{info:e}=t;document.getElementById("creationDate").textContent=e.CreationDate||"N/A",document.getElementById("modificationDate").textContent=e.ModDate||"N/A",document.getElementById("createdBy").textContent=e.Creator||"N/A",document.getElementById("modifiedBy").textContent=e.Producer||"N/A"}))}function u(t){(async()=>{let e=0,n=0,o=0;for(let d=1;d<=t.numPages;d++){const a=await t.getPage(d),c=await a.getTextContent();for(const t of c.items)e++;const i=await a.getAnnotations();o+=i.length;for(const t of i)(t.fontName&&t.fontName.toLowerCase().includes("shx")||t.title&&t.title.toLowerCase().includes("shx"))&&n++}document.getElementById("textBoxCount").textContent=e,document.getElementById("shxCommentsCount").textContent=n,document.getElementById("layerCount").textContent=1,document.getElementById("commentsCount").textContent=o})()}e.addEventListener("click",(()=>t.click())),t.addEventListener("change",(t=>{const e=t.target.files[0];if(e){const t=new FileReader;t.onload=function(){const t=new Uint8Array(this.result);pdfjsLib.getDocument(t).promise.then((t=>{c=t,i=1,l(),document.getElementById("filename").textContent=e.name,r(t),u(t),s(t.numPages)}))},t.readAsArrayBuffer(e)}})),o.addEventListener("input",(()=>{m=parseFloat(o.value),l()}));
//# sourceMappingURL=drawing-validation.html.map
    </script>
</body>
</html>
